<view class="container">
  <view class="header">
    <view class="back-button" bindtap="goBack"><text class="back-icon">â†</text></view>
    <text class="header-title">æˆ‘çš„æ¶ˆæ¯</text>
    <view class="header-actions">
      <text class="mark-all-read" bindtap="markAllRead">å…¨éƒ¨å·²è¯»</text>
    </view>
  </view>
  
  <!-- æ¶ˆæ¯åˆ†ç±»æ ‡ç­¾ -->
  <view class="message-tabs">
    <view class="tab {{activeTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-tab="all">
      å…¨éƒ¨
      <view class="tab-badge" wx:if="{{unreadCounts.all > 0}}">{{unreadCounts.all}}</view>
    </view>
    <view class="tab {{activeTab === 'comment' ? 'active' : ''}}" bindtap="switchTab" data-tab="comment">
      è¯„è®º
      <view class="tab-badge" wx:if="{{unreadCounts.comment > 0}}">{{unreadCounts.comment}}</view>
    </view>
    <view class="tab {{activeTab === 'vote' ? 'active' : ''}}" bindtap="switchTab" data-tab="vote">
      æŠ•ç¥¨
      <view class="tab-badge" wx:if="{{unreadCounts.vote > 0}}">{{unreadCounts.vote}}</view>
    </view>
    <view class="tab {{activeTab === 'system' ? 'active' : ''}}" bindtap="switchTab" data-tab="system">
      ç³»ç»Ÿ
      <view class="tab-badge" wx:if="{{unreadCounts.system > 0}}">{{unreadCounts.system}}</view>
    </view>
  </view>
  
  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view class="message-list" scroll-y enable-back-to-top bindscrolltolower="loadMoreMessages">
    <block wx:if="{{messages.length > 0}}">
      <view wx:for="{{messages}}" wx:key="_id" class="message-item {{item.status === 0 ? 'unread' : ''}}">
        <!-- æ¶ˆæ¯å¤´éƒ¨ -->
        <view class="message-header">
          <image class="sender-avatar" src="{{item.senderAvatar}}" mode="aspectFill"></image>
          <view class="message-info">
            <text class="sender-name">{{item.senderName}}</text>
            <text class="message-time">{{formatTime(item.createTime)}}</text>
          </view>
          <view class="unread-indicator" wx:if="{{item.status === 0}}"></view>
        </view>
        
        <!-- æ¶ˆæ¯å†…å®¹ -->
        <view class="message-content" bindtap="onMessageTap" data-id="{{item._id}}" data-related="{{item.relatedId}}" data-nomination="{{item.nominationId}}">
          <text>{{item.content}}</text>
          <view class="nomination-ref" wx:if="{{item.nominationTitle}}">
            æ¥è‡ªï¼š{{item.nominationTitle}}
          </view>
        </view>
      </view>
    </block>
    
    <!-- åŠ è½½æ›´å¤š -->
    <view class="loading-more" wx:if="{{hasMore}}" bindtap="loadMoreMessages">
      <text>åŠ è½½æ›´å¤š...</text>
    </view>
    
    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view class="no-more" wx:if="{{messages.length > 0 && !hasMore}}">
      <text>æ²¡æœ‰æ›´å¤šæ¶ˆæ¯äº†</text>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{messages.length === 0}}">
      <view class="empty-icon">ğŸ“­</view>
      <text class="empty-text">æš‚æ— æ¶ˆæ¯</text>
    </view>
  </scroll-view>
</view> 