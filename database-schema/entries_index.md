# Entries Collection Index Configuration

## 主页排名索引要求

为了支持新的排名规则（按想吃数降序，票数相同时新上榜的在上面），需要在 `entries` 集合中添加以下索引：

### 1. 主要排名索引
```javascript
// 复合索引：支持按票数降序 + 创建时间降序排序
{
  "votes": -1,          // 按票数降序（主要排序）
  "_createTime": -1     // 票数相同时按创建时间降序（新的在前）
}
```

### 2. 数据库控制台设置步骤
1. 进入腾讯云数据库控制台
2. 选择对应的云开发环境
3. 进入 `entries` 集合
4. 点击"索引管理"
5. 创建复合索引，字段顺序如上

### 3. 备用索引（当前已有）
```javascript
// 单字段索引：只按票数排序
{
  "votes": -1
}
```

### 4. 查询性能验证
```javascript
// 测试查询语句
db.collection('entries')
  .where({ votes: _.gte(0) })
  .orderBy('votes', 'desc')
  .orderBy('_createTime', 'desc')
  .limit(50)
  .get()
```

## 排名规则说明

### 新排名逻辑
1. **主要排序**: 按 `votes`（想吃数）从高到低
2. **次要排序**: 票数相同时，按 `_createTime` 从新到老
   - 新上榜的用户在相同票数中排名更靠前
   - 鼓励新用户参与，增加榜单活跃度

### 示例排序结果
```
用户A: 100票, 2024-01-15 → 排名 1
用户B: 100票, 2024-01-10 → 排名 2  (票数相同，但上榜较早)
用户C: 99票,  2024-01-20 → 排名 3
```

## 注意事项

- 索引创建可能需要一些时间
- 复合索引支持多种查询模式
- 确保 `_createTime` 字段在所有条目中存在
- 如果字段缺失，代码中有兜底逻辑使用 `createdAt` 或当前时间
