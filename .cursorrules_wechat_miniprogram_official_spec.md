# 微信小程序官方开发规范全集

基于微信官方开发文档 (developers.weixin.qq.com) 的完整开发规范，所有小程序代码必须严格遵守以下规范。

## 🏛️ 平台运营规范

### 地理位置使用规范

- **强制用户同意**：在采集、传送或使用地理位置数据之前，必须通知并获得用户同意
- **禁止自动控制**：不得使用基于地理位置的API用于车辆、飞机或其他设备的自动控制或自主控制
- **禁止调度服务**：不得使用基于地理位置的API用于调度、车队管理或应急服务
- **数据使用限制**：地理位置数据仅能提供给必须基于用户地理位置才能提供服务的小程序
- **隐私保护**：地理位置数据只能用于该小程序提供的直接相关功能或服务，不得公开展示给其他用户

### 支付规范

- **明确标识**：若小程序内存在支付行为，需在小程序的简介中有明确的指示
- **支付提示**：执行支付动作前，需在页面中对用户有明确的提示
- **禁止捐款**：未经腾讯许可，不得使用微信支付作为捐款和募捐
- **合规经营**：在小程序平台使用支付功能的，应当依照法律、法规等规范性文件的规定开展
- **禁止违法**：不得实施非法吸收公众存款、集资诈骗等违法犯罪行为，或为违法犯罪行为提供协助
- **遵守协议**：使用微信支付等腾讯提供的第三方支付工具的，需遵守《微信支付服务协议》和《微信支付用户服务协议》等服务协议和平台规则

## 🔧 技术实现规范

### 系统安全要求

- **漏洞测试授权**：允许并授权微信团队对提交的代码进行漏洞安全测试
- **系统安全**：严禁利用手机系统、微信或其他软件或硬件的技术漏洞
- **可执行代码禁止**：不得安装或运行其他可执行代码的程序
- **病毒传播禁止**：不得利用小程序传播病毒

### API 使用规范

- **公开API限制**：不得使用非公开的API
- **内测API风险**：使用内测中的API，微信团队有权保留回收接口的权利
- **跨主体禁止**：禁止违规（跨主体）使用其他第三方应用的API
- **商业限制**：未经腾讯允许，不得将微信的代码、API或工具出售、转让或转授给他人

### 网络访问规范

- **HTTPS强制**：访问网络需要服务器端支持HTTPS安全连接，且端口号必须为443
- **域名白名单**：小程序只能访问开发者在登记小程序时所设定的服务器地址
- **支持的连接类型**：
  - HTTP连接请求
  - Socket持续性连接
  - 文件收发接口

## 📄 WXML 语法规范

### 数据绑定规范

```wxml
<!-- ✅ 正确：简单数据绑定 -->
<view>{{ message }}</view>
<view>{{ user.name }}</view>
<view class="{{ isActive ? 'active' : '' }}"></view>

<!-- ❌ 错误：不能在插值中调用函数 -->
<view>{{ message.trim() }}</view>
<view>{{ list.map(item => item.name) }}</view>
<view>{{ data.filter(item => item.active) }}</view>
```

### 列表渲染规范

```wxml
<!-- ✅ 正确：列表渲染 -->
<view wx:for="{{ list }}" wx:key="id">
  {{ item.name }}
</view>

<!-- ✅ 正确：指定索引和项的变量名 -->
<view wx:for="{{ list }}" wx:for-index="idx" wx:for-item="itemName" wx:key="id">
  {{ idx }}: {{ itemName.name }}
</view>
```

### 条件渲染规范

```wxml
<!-- ✅ 正确：条件渲染 -->
<view wx:if="{{ condition }}">显示内容</view>
<view wx:elif="{{ condition2 }}">其他内容</view>
<view wx:else>默认内容</view>

<!-- ✅ 正确：控制多个节点 -->
<block wx:if="{{ condition }}">
  <view>节点1</view>
  <view>节点2</view>
</block>
```

### 事件绑定规范

```wxml
<!-- ✅ 正确：事件绑定 -->
<button bindtap="handleTap">点击</button>
<button bind:tap="handleTap">点击</button>
<button catchtap="handleTap">点击（阻止冒泡）</button>

<!-- ✅ 正确：传递数据 -->
<button bindtap="handleTap" data-id="{{ item.id }}">点击</button>
```

## 🎨 WXSS 样式规范

### 尺寸单位规范

```wxss
/* ✅ 推荐：使用rpx进行响应式设计 */
.container {
  width: 750rpx;  /* 屏幕宽度 */
  height: 100rpx;
}

/* ✅ 可用单位 */
.element {
  width: 100px;   /* 像素 */
  height: 10em;   /* 相对单位 */
  margin: 1rem;   /* 根元素字体大小 */
}
```

### 样式导入规范

```wxss
/* ✅ 正确：样式导入 */
@import "common.wxss";

/* ✅ 正确：使用相对路径 */
@import "../../styles/base.wxss";
```

### 选择器规范

```wxss
/* ✅ 支持的选择器 */
.class-selector { }      /* 类选择器 */
#id-selector { }         /* ID选择器 */
element { }              /* 元素选择器 */
element, element { }     /* 群组选择器 */
::after { }              /* 伪元素 */
::before { }             /* 伪元素 */
```

## 📜 WXS 脚本规范

### 语法限制

```wxs
/* ❌ 错误：不能使用 ES6 语法 */
let data = [];
const name = 'test';
const func = () => {};

/* ✅ 正确：必须使用 var 声明 */
var data = [];
var name = 'test';
var func = function() {};

/* ✅ 正确：支持的语法 */
var module = {
  filter: function(list, key) {
    var result = [];
    for (var i = 0; i < list.length; i++) {
      if (list[i][key]) {
        result.push(list[i]);
      }
    }
    return result;
  }
};

module.exports = module;
```

### WXS 使用规范

```wxml
<!-- ✅ 内联 WXS -->
<wxs module="utils">
var formatTime = function(timestamp) {
  var date = getDate(timestamp);
  return date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate();
};
module.exports = {
  formatTime: formatTime
};
</wxs>

<!-- ✅ 外部 WXS 文件 -->
<wxs src="../../utils/tools.wxs" module="tools"></wxs>

<view>{{ utils.formatTime(timestamp) }}</view>
<view>{{ tools.format(data) }}</view>
```

## 📱 小程序架构规范

### 文件结构规范

```
project/
├── app.js          # 小程序逻辑
├── app.json        # 小程序公共配置
├── app.wxss        # 小程序公共样式表
├── pages/          # 页面文件夹
│   ├── index/
│   │   ├── index.js    # 页面逻辑
│   │   ├── index.json  # 页面配置
│   │   ├── index.wxml  # 页面结构
│   │   └── index.wxss  # 页面样式表
│   └── detail/
│       ├── detail.js
│       ├── detail.json
│       ├── detail.wxml
│       └── detail.wxss
├── utils/          # 工具函数
├── components/     # 自定义组件
└── images/         # 图片资源
```

### app.json 配置规范

```json
{
  "pages": [
    "pages/index/index",
    "pages/detail/detail"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "小程序",
    "navigationBarTextStyle": "black"
  },
  "tabBar": {
    "color": "#999",
    "selectedColor": "#333",
    "backgroundColor": "#fff",
    "borderStyle": "black",
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "首页",
        "iconPath": "images/home.png",
        "selectedIconPath": "images/home-active.png"
      }
    ]
  },
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000
  }
}
```

## 🔄 生命周期规范

### 应用生命周期

```javascript
// app.js
App({
  onLaunch: function (options) {
    // 小程序初始化完成时触发，全局只触发一次
  },
  onShow: function (options) {
    // 小程序启动，或从后台进入前台显示时触发
  },
  onHide: function () {
    // 小程序从前台进入后台时触发
  },
  onError: function (msg) {
    // 小程序发生脚本错误或 API 调用报错时触发
  },
  onPageNotFound: function (res) {
    // 小程序要打开的页面不存在时触发
  },
  globalData: {
    // 全局数据
  }
});
```

### 页面生命周期

```javascript
// pages/index/index.js
Page({
  data: {
    // 页面的初始数据
  },
  onLoad: function (options) {
    // 页面加载时触发，一个页面只会调用一次
  },
  onReady: function () {
    // 页面初次渲染完成时触发，一个页面只会调用一次
  },
  onShow: function () {
    // 页面显示/切入前台时触发
  },
  onHide: function () {
    // 页面隐藏/切入后台时触发
  },
  onUnload: function () {
    // 页面卸载时触发
  },
  onPullDownRefresh: function () {
    // 用户下拉刷新时触发
  },
  onReachBottom: function () {
    // 页面上拉触底时触发
  },
  onShareAppMessage: function () {
    // 用户点击右上角分享时触发
  }
});
```

## 🔌 多媒体与存储规范

### 音频播放规范

- **基础播放控制**：提供播放、暂停和停止播放三种接口
- **功能限制**：不提供跳转至某个播放时间点的功能，也不能获取目前的播放进度
- **音乐播放增强**：音乐播放接口提供基础播放控制外的音乐状态检查和监听等功能

### 多媒体数据交换

- **照片和视频**：小程序提供照片和视频数据交换接口，可访问用户选定或拍摄的照片与视频
- **临时文件处理**：通过音频录制和视频照片接口获得的多媒体信息是临时的
- **永久保存**：需要通过小程序存储文件接口对文件进行永久保存

### 数据存储规范

- **文本数据存储**：小程序提供存储接口，以「字段 – 值」的一对一形式进行保存
- **必须使用官方接口**：播放多媒体或进行数据存储，必须使用微信提供的小程序多媒体播放控制接口及存储接口

## 🛠️ 硬件相关规范

### 系统信息获取

- **可获取信息**：网络状态、设备型号、窗口尺寸等系统相关信息
- **传感器数据**：重力感应数据和罗盘数据
- **获取方式限制**：这些数据只能主动获取，不能通过数值变化的回调实时获取

## 📢 推送服务规范

### 模板消息规范

- **用途限制**：只能用于通知提醒，不能用于群发
- **审核要求**：需在微信小程序后台登记新的模板推送消息并审核通过后，才能在小程序中使用
- **推送流程**：
  1. 模板消息审核通过
  2. 向微信服务器获取 Access Token
  3. 将 Access Token、模板编号和模板中的动态变量提交给微信
  4. 由微信向用户推送通知

## 🔐 安全合规要求

### 数据安全

- **敏感信息保护**：不得在前端存储或传输敏感信息（如 session_key、AppSecret）
- **数据加密**：敏感数据传输必须使用 HTTPS
- **权限最小化**：只申请必要的用户权限

### 用户隐私

- **明确告知**：收集用户信息前必须明确告知用途
- **最小收集**：只收集必要的用户信息
- **用户同意**：获取敏感权限前必须获得用户明确同意

## 📚 开发工具要求

### 开发环境

- **官方工具**：必须使用微信官方提供的微信开发者工具
- **平台支持**：支持 Windows 和 macOS 平台
- **版本要求**：使用最新稳定版本的开发者工具

### 调试规范

- **真机测试**：关键功能必须在真机上测试
- **多端适配**：确保在不同设备和微信版本上的兼容性
- **性能优化**：监控并优化小程序性能

## ⚖️ 主体认证限制

- **个人主体**：个人注册的小程序主体无法进行认证，会有功能限制
- **企业主体**：企业主体可以申请认证，获得更多功能权限
- **认证费用**：企业认证需要缴纳相应的认证费用

## 🚨 违规处理

### 违规后果

- **账号回收**：一旦发现违规行为，将回收小程序主体的账号资格
- **功能限制**：违规程度较轻时，可能限制部分功能
- **永久封禁**：严重违规可能导致永久封禁

### 合规建议

- **定期审查**：定期审查代码和功能的合规性
- **关注更新**：及时关注微信官方的规范更新
- **测试验证**：上线前充分测试所有功能的合规性

---

## 📖 官方文档参考

- [小程序开发框架参考文档](https://developers.weixin.qq.com/)
- [小程序组件参考文档](https://developers.weixin.qq.com/)  
- [小程序 API 参考文档](https://developers.weixin.qq.com/)
- [小程序服务端 API 参考文档](https://developers.weixin.qq.com/)
- [WXML 语法参考](https://developers.weixin.qq.com/)
- [WXSS 样式参考](https://developers.weixin.qq.com/)
- [WXS 脚本参考](https://developers.weixin.qq.com/)

---

**重要提醒**：本规范基于微信官方开发文档整理，在开发过程中请始终以最新的官方文档为准。所有代码必须严格遵守上述规范，确保小程序的合规性和稳定性。
